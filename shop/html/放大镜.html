<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/common.css">
    <script src="../js/node_modules/jquery/dist/jquery.js"></script>
    <style>
        .details {
            width: 100%;
            height: 100%;
        }

        .top {
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        .return {
            width: 0.89rem;
            height: 0.4rem;
            margin-top: 0.1rem;
            cursor: pointer;
            border: 1px solid #dcdfe6;
            border-color: #dcdfe6;
            color: #606266;
            background: #fff;
            text-align: center;
            line-height: 0.4rem;
        }

        .return:hover {
            background-color: rgb(206, 162, 206);
            color: purple;
        }

        .main {
            height: 4.76rem;
            width: 100%;
            display: flex;
            position: relative;
        }

        .top-img {
            width: 4.76rem;
            height: 4.76rem;
            position: relative;
        }

        .large-img {
            width: 4rem;
            height: 4rem;
            cursor: crosshair;
            position: relative;
        }

        .large-img>img {
            width: 100%;
            height: 100%;
        }
        /* 加一个透明罩 */
        .mantle{
            background-color:transparent;
            width: 4.76rem;
            height: 4.76rem;
            position: absolute;
            top: 0;
            left: 0;
        }
        .mark{
            width: 2rem;
            height: 2rem;
            background-color: white;
            opacity: 0.4;
            position: absolute;
            top: 0;
            left: 0;
        }

        .enlarge {
            width: 4rem;
            height: 4rem;
            overflow: hidden;
            position: absolute;
            right: -4rem;
            top: 0;
            display: none;
        }

        .enlarge>img {
            width: 200%;
            height: 200%;
            position: relative;
        }

        .fixed {
            width: 0.76rem;
            height: 0.76rem;
            display: flex;
            /* border: 2px solid #6e496e; */
        }

        .fixed>img {
            width: 100%;
            height: 100%;
            opacity: 0.4
        }

        .introduce {
            width: 70%;
            height: 4rem;
            display: flex;
            justify-content: center;
            align-items: center;
            /* margin: 0 auto; */
        }

        .introduce-item {
            width: 30%;
            height: 50%;
        }

        .title {
            font-size: 0.2rem;
            font-weight: bolder;
            width: 2.5rem;
            height: .31rem;
        }

        .supplier {
            width: 2.5rem;
            height: .21rem;
            color: #666;
            margin: 0.2rem 0;
        }

        .prices {
            color: red;
            width: 2.5rem;
            height: .21rem;
            margin: 0.2rem 0;
        }

        .shopcatBtn {
            cursor: pointer;
            color: #fff;
            background-color: #f56c6c;
            border-color: #f56c6c;
            border: 1px solid #dcdfe6;
            width: 1.06rem;
            height: .4rem;
            line-height: .4rem;
            border-radius: 0.05rem;
            text-align: center;
        }

        .down {
            width: 100%;
        }

        .resemble {
            width: 100%;
            padding-bottom: 0.1rem;
            font-weight: bold;
            border-bottom: 1px solid #dedede
        }

        .shoplist {
            display: flex;
            flex-wrap: wrap;
        }

        .goods {
            width: 20%;
            height: 2.8rem;
            display: flex;
            flex-direction: column;
            /* margin: .05rem; */
            padding: .05rem;
            cursor: pointer;
        }

        .goods-img {
            width: 2.2rem;
            height: 2.2rem;
        }

        .goods-img img {
            width: 100%;
            height: 100%;
        }

        .goods-title {
            width: 2.2rem;
            height: .21rem;

            font-size: 16px;
            color: #424242;

        }

        .price {
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>

<body>
    <!-- <div class="details">
        </div> -->
    <!-- <div class="top">
            <div class="return"> <—返回</div>
            <div class="main">
                <div class="top-img">
                    <div class="large-img">
                        <img src="../img/a.jpg" alt="">
                    </div>
                    <div class="enlarge">
                        <img src="../img/a.jpg" alt="">
                    </div>
                    <div class="fixed">
                        <img src="../img/logo.png" alt="">
                    </div>
                </div>
                <div class="introduce">
                    <div class="introduce-item">
                        <div class="title">手冲咖啡6杯装(定制款)</div>
                        <div class="supplier">星巴克咖啡产地制造商直供</div>
                        <div class="prices">￥59</div>
                        <div class="star"><img src="../img/star.png" alt=""></div>
                        <div class="shopcatBtn">添加到购物车</div>
                    </div>
                </div>
            </div>
        </div> -->
    <!-- <div class="down">
            <div class="resemble">相似商品推荐</div>
       
        <div class="shoplist">
            <div class="goods">
                <div class="goods-img"><img src="${data[num].img_list_url}" alt=""></div>
                <div class="goods-title">${data[num].title}</div>
                <div class="price">
                    <div>${data[num].price}</div>
                    <div>${data[num].mack}</div>
                </div>
            </div>
        </div>
    </div>
    </div> -->



</body>

</html>
<script>
    $(window).ready(function () {
        var useId = sessionStorage.getItem('value');
        $.ajax({
            method: 'get',
            data: useId,
            url: `http://vebcoder.cn:9527/api/detail?goodId=${useId}`,
            success: function (data) {
                var details = document.createElement('div');
                details.className = 'details';
                $('body').append(details);

                var top = document.createElement('div');
                top.className = 'top';
                top.innerHTML = `
                <div class="return"><—返回</div>
                        <div class="main">
                            <div class="top-img">
                                <div class="large-img">
                                    <img src="${data[0].img_list_url}" alt="">
                                    <div class="mark"></div>
                                    <div class="mantle"></div>
                                </div>
                                <div class="enlarge">
                                    <img src="${data[0].img_url}" alt="">
                                </div>
                                <div class="fixed">
                                </div>
                            </div>
                            <div class="introduce">
                                <div class="introduce-item">
                                    <div class="title">${data[0].title}</div>
                                    <div class="supplier">${data[0].supplier}</div>
                                    <div class="prices">${data[0].price}</div>
                                    <div class="star"><img src="../img/star.png" alt=""></div>
                                    <div class="shopcatBtn">添加到购物车</div>
                                </div>
                            </div>
            `;
                var imgs = JSON.parse(data[0].imgs);
                setTimeout(function () {
                    Array.from(imgs).forEach(function (ele) {
                        var img = document.createElement('img');
                        img.src = ele;
                        $('.fixed').append(img);
                    });
                }, 1)
                details.append(top);

                var datalocal = localStorage.getItem('shoplist');
                datalocal = JSON.parse(datalocal);
                var down = document.createElement('div');
                down.className = 'down';
                down.innerHTML = ' <div class="resemble">相似商品推荐</div> ';
                details.append(down)
                var shoplist = document.createElement('shoplist');
                shoplist.className = 'shoplist';
                var str1 = '';
                var n = 0;
                datalocal.forEach(function (ele) {
                    if (ele.type_one === data[0].type_one) {
                        if (n > 9) {
                            n = 0;
                            return
                        }
                        str1 += `
                        <div class="goods">
                            <div class="goods-img"><img src="${ele.img_list_url}" alt=""></div>
                            <div class="goods-title">${ele.title}</div>
                            <div class="price">
                                <div>${ele.price}</div>
                                <div>${ele.mack}</div>
                            </div>
                        </div>
                        `;
                        n++
                    }

                })
                shoplist.innerHTML = str1;
                details.append(shoplist);


            },
            error: function (err) {
                console.log(err)
            }
        })
    })


    // 为什么必须要写道setTimout中切时间特别长 才可以获取到元素
    setTimeout(function () {
        // 点击返回
        $('.return').on('click',function(){
            history.go(-1)
        })



        var x = 0;
        // 初始化
        $('.fixed>img:eq(' + x + ')').css({
            border: ' 2px solid #6e496e',
            opacity: '1'
        })
        $('.large-img>img').attr('src', $('.fixed>img:eq(' + x + ')').attr('src'));
        // 点击小图切换
        $('.fixed>img').on('click', function () {
            $('.fixed>img:eq(' + x + ')').css({
                border: ' 2px solid transparent',
                opacity: '0.4'
            })
            x = $(this).index();
            $('.fixed>img:eq(' + x + ')').css({
                border: ' 2px solid #6e496e',
                opacity: '1'
            })
            $('.large-img>img').attr('src', $('.fixed>img:eq(' + x + ')').attr('src'));
            $('.enlarge>img').attr('src', $('.fixed>img:eq(' + x + ')').attr('src'));
        })
        // 移动到大图显示放大镜
        $('.large-img').on('mouseover',function(){
            $('.enlarge').css({
                display:'block',
            })
        })
        // 鼠标移动蒙层定位
        $('.large-img').on('mousemove',function(e){
            $('.large-img>.mark').css({
                top:e.offsetY-100+'px',
                left:e.offsetX-100+'px',  
            })
            $('.enlarge>img').css({
                top:(-e.offsetY)+'px',
                left:(-e.offsetX)+'px',
            })
           console.log(e.offsetX,e.offsetY)
        })
        // 移出
        $('.large-img').on('mouseout',function(){
            $('.enlarge').css({
                display:'none',
            })
        })
    }, 300)
</script>